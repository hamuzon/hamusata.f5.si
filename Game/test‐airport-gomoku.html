<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>空港並べ（五目並べ） / Airport Gomoku</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; margin:10px; transition: background 1s;}
h1 { color:#333;}
#controls { margin-bottom:10px;}
#board { display:grid; gap:2px; margin:0 auto; max-width:90vw; max-height:90vw; grid-template-rows:repeat(10,1fr); grid-template-columns:repeat(10,1fr);}
.cell { border:1px solid #333; display:flex; justify-content:center; align-items:center; font-size:min(2.5vw,24px); cursor:pointer; aspect-ratio:1/1; transition: background 0.5s,color 0.3s;}
.player1 { background-color:#3498db;}
.player2 { background-color:#e74c3c;}
.highlight { background-color:#ff0 !important; color:#000 !important;}
#status { margin-top:10px; font-size:1.2em; font-weight:bold; padding:5px; border-radius:5px; color:#fff; transition: background 0.5s;}
#scoreboard { margin-top:10px; font-size:1.2em;}
button, select { margin-top:10px; padding:5px 10px; font-size:1em;}
</style>
</head>
<body>

<h1>空港並べ（五目並べ）</h1>

<div id="controls">
  対戦モード：
  <select id="modeSelect">
    <option value="human-cpu">人 vs CPU</option>
    <option value="cpu-cpu">CPU vs CPU</option>
    <option value="human-human">人 vs 人</option>
  </select>
  CPU難易度：
  <select id="cpuLevel">
    <option value="1">簡単</option>
    <option value="2">中級</option>
    <option value="3">上級</option>
  </select>
  先手：
  <select id="firstPlayer">
    <option value="1">プレイヤー1</option>
    <option value="2">プレイヤー2</option>
  </select>
</div>

<div id="board"></div>
<p id="status">プレイヤー1のターン</p>
<p id="scoreboard">スコア - プレイヤー1: 0 | プレイヤー2: 0</p>
<button id="restartBtn">リスタート</button>
<button id="downloadBtn">履歴保存 (JSON)</button>
<input type="file" id="loadFile" accept=".json">

<script>
const SIZE=10, WIN_COUNT=5;
let board=[], currentPlayer=1, scores=[0,0], movesThisGame=[], historyData=[];
const boardEl=document.getElementById("board");
const statusEl=document.getElementById("status");
const scoreboardEl=document.getElementById("scoreboard");
const restartBtn=document.getElementById("restartBtn");
const downloadBtn=document.getElementById("downloadBtn");
const loadFile=document.getElementById("loadFile");
const modeSelect=document.getElementById("modeSelect");
const cpuLevelSelect=document.getElementById("cpuLevel");
const firstPlayerSelect=document.getElementById("firstPlayer");

const playerColors=["#3498db","#e74c3c"];
let playerTypes=["Human","CPU"]; // 1,2のタイプ

function createBoard(){
  board=Array(SIZE).fill(null).map(()=>Array(SIZE).fill(0));
  movesThisGame=[];
  boardEl.innerHTML="";
  document.body.style.background="#fff";

  // CPU/Human設定
  const mode=modeSelect.value;
  const first=parseInt(firstPlayerSelect.value);
  if(mode==="human-cpu"){
    playerTypes[first-1]="CPU";
    playerTypes[2-first]="Human";
  } else if(mode==="cpu-cpu"){
    playerTypes=["CPU","CPU"];
  } else playerTypes=["Human","Human"];

  currentPlayer=first;
  updateStatus();

  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      const cell=document.createElement("div");
      cell.classList.add("cell");
      cell.addEventListener("click",()=>handleClick(r,c,cell));
      boardEl.appendChild(cell);
    }
  }

  // CPU先手なら自動開始
  if(playerTypes[currentPlayer-1]==="CPU") setTimeout(cpuMove,300);
}

function updateStatus(){
  statusEl.style.backgroundColor = playerColors[currentPlayer-1];
  statusEl.textContent = `${playerTypes[currentPlayer-1]}（プレイヤー${currentPlayer}）のターン`;
}

function handleClick(r,c,cell){
  if(board[r][c]!==0) return;
  if(playerTypes[currentPlayer-1]==="CPU") return;
  makeMove(r,c,currentPlayer,cell);
  if(checkWin(r,c,currentPlayer)) return handleWin(currentPlayer);
  nextTurn();
}

function makeMove(r,c,player,cell){
  board[r][c]=player;
  cell.textContent=player===1?"✈":"🛬";
  cell.classList.add(player===1?"player1":"player2");
  movesThisGame.push([r,c,player]);
}

function nextTurn(){
  currentPlayer=currentPlayer===1?2:1;
  updateStatus();
  if(playerTypes[currentPlayer-1]==="CPU") setTimeout(cpuMove,300);
}

function cpuMove(){
  const level=parseInt(cpuLevelSelect.value);
  let r,c;
  if(level===1) [r,c]=getRandomEmptyCell();
  else [r,c]=getSmartMove();
  const cell=boardEl.children[r*SIZE+c];
  makeMove(r,c,currentPlayer,cell);
  if(checkWin(r,c,currentPlayer)) return handleWin(currentPlayer);
  nextTurn();
}

function getRandomEmptyCell(){
  const empty=[];
  for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) if(board[r][c]===0) empty.push([r,c]);
  return empty[Math.floor(Math.random()*empty.length)];
}

function getSmartMove(){
  // 勝てる手
  for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++){
    if(board[r][c]===0){ board[r][c]=currentPlayer; if(checkWin(r,c,currentPlayer)){ board[r][c]=0; return [r,c]; } board[r][c]=0;}
  }
  // 相手阻止
  const opponent = currentPlayer===1?2:1;
  for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++){
    if(board[r][c]===0){ board[r][c]=opponent; if(checkWin(r,c,opponent)){ board[r][c]=0; return [r,c]; } board[r][c]=0;}
  }
  // 履歴学習（簡易）
  for(let past of historyData){
    if(past.winner===currentPlayer){
      for(let [r,c,p] of past.moves){
        if(board[r][c]===0) return [r,c];
      }
    }
  }
  return getRandomEmptyCell();
}

function checkWin(r,c,player){
  const dirs=[[0,1],[1,0],[1,1],[1,-1]];
  for(let [dr,dc] of dirs){
    let count=1,line=[[r,c]];
    for(let i=1;i<WIN_COUNT;i++){
      let nr=r+dr*i,nc=c+dc*i; if(nr<0||nc<0||nr>=SIZE||nc>=SIZE||board[nr][nc]!==player) break; line.push([nr,nc]); count++;
    }
    for(let i=1;i<WIN_COUNT;i++){
      let nr=r-dr*i,nc=c-dc*i; if(nr<0||nc<0||nr>=SIZE||nc>=SIZE||board[nr][nc]!==player) break; line.push([nr,nc]); count++;
    }
    if(count>=WIN_COUNT){ highlightLine(line); return true;}
  }
  return false;
}

function highlightLine(line){
  line.forEach(([r,c])=>{
    const cell=boardEl.children[r*SIZE+c];
    if(cell) cell.classList.add("highlight");
  });
}

function handleWin(player){
  scores[player-1]++;
  scoreboardEl.textContent=`スコア - プレイヤー1: ${